# 日志配置说明

## 配置文件
`src/main/resources/logback-spring.xml`

## 日志文件位置

### 本地环境
- 路径：`项目根目录/logs/`
- 文件：
  - `nianhua.log` - 所有INFO及以上级别日志
  - `nianhua_error.log` - 仅ERROR级别日志
  - `nianhua_sql.log` - MyBatis SQL日志

### Docker环境
- 路径：`容器内 /app/logs/`
- 建议挂载到宿主机：

```yaml
# docker-compose.yml
services:
  app:
    volumes:
      - ./logs:/app/logs  # 将容器日志目录挂载到宿主机
```

## 日志轮转策略

- **单个文件大小**：100MB
- **保留天数**：30天
- **总大小限制**：10GB
- **命名规则**：`nianhua.2024-12-09.0.log`

## 日志级别

| Logger | 级别 | 输出位置 |
|--------|------|----------|
| 项目业务代码 | INFO | 控制台 + 文件 |
| MyBatis SQL | DEBUG | 控制台 + SQL文件 |
| Spring Framework | INFO | 控制台 + 文件 |
| MyBatis | WARN | 不输出 |
| Druid | WARN | 不输出 |

## 查看日志

### 本地开发
```bash
# 实时查看
mvn spring-boot:run

# 或者查看日志文件
tail -f logs/nianhua.log
```

### Docker环境
```bash
# 查看容器日志
docker compose logs -f app

# 查看挂载的日志文件
tail -f logs/nianhua.log
```

### 远程服务器
```bash
# 查看实时日志
ssh -i ./home-edu.pem root@118.178.190.93
cd /opt/nianhua-wechat-miniprogram-backend
docker compose logs -f app

# 查看日志文件（如果挂载了）
ssh -i ./home-edu.pem root@118.178.190.93
cd /opt/nianhua-wechat-miniprogram-backend
tail -f logs/nianhua.log
```

## 日志格式

```
2024-12-09 10:30:45.123 [main] INFO  o.e.n.controller.UserController - 用户登录成功
```

- 日期时间（毫秒）
- 线程名
- 日志级别（INFO/DEBUG/WARN/ERROR）
- Logger名称（简写）
- 日志消息

## MyBatis SQL日志

SQL日志会输出到：
- 控制台（DEBUG级别）
- `logs/nianhua_sql.log` 文件

示例：
```
2024-12-09 10:30:45.123 [http-nio-8080-exec-1] DEBUG o.e.n.m.UserMapper.selectById - ==>  Preparing: SELECT * FROM users WHERE id = ?
2024-12-09 10:30:45.124 [http-nio-8080-exec-1] DEBUG o.e.n.m.UserMapper.selectById - ==> Parameters: 1(Long)
2024-12-09 10:30:45.125 [http-nio-8080-exec-1] DEBUG o.e.n.m.UserMapper.selectById - <==      Total: 1
```

## 自定义Logger

在代码中使用：

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class UserService {
    private static final Logger logger = LoggerFactory.getLogger(UserService.class);

    public void login() {
        logger.info("用户登录成功");
        logger.debug("调试信息：userId={}", userId);
        logger.warn("警告信息");
        logger.error("错误信息", exception);
    }
}
```

## 修改日志级别

可以在 `application.yml` 中覆盖：

```yaml
logging:
  level:
    org.exh.nianhuawechatminiprogrambackend: DEBUG  # 修改项目日志级别
    org.mybatis: INFO                                # 修改MyBatis日志级别
```
